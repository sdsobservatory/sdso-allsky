import math
from app.cameras import Camera


class ASI224MC(Camera):
    """
    All characterization measurements performed with an f/1.8 1.55mm fisheye lens.
    """

    """
    Bias median measured at 1 microsecond exposure, 10 offset.
    Value is 16-bit, has not been reduced to native ADC bit depth.
    """
    BIAS_MEDIAN_LOOKUP = {
        0: 160,
        1: 160,
        2: 160,
        3: 160,
        4: 160,
        5: 160,
        6: 160,
        7: 160,
        8: 160,
        9: 160,
        10: 160,
        11: 160,
        12: 160,
        13: 160,
        14: 160,
        15: 160,
        16: 160,
        17: 160,
        18: 160,
        19: 160,
        20: 160,
        21: 160,
        22: 160,
        23: 160,
        24: 160,
        25: 160,
        26: 160,
        27: 160,
        28: 160,
        29: 160,
        30: 160,
        31: 160,
        32: 160,
        33: 160,
        34: 160,
        35: 160,
        36: 160,
        37: 160,
        38: 144,
        39: 144,
        40: 144,
        41: 144,
        42: 144,
        43: 144,
        44: 144,
        45: 144,
        46: 144,
        47: 144,
        48: 144,
        49: 144,
        50: 144,
        51: 144,
        52: 144,
        53: 144,
        54: 144,
        55: 144,
        56: 144,
        57: 144,
        58: 144,
        59: 144,
        60: 144,
        61: 160,
        62: 160,
        63: 160,
        64: 160,
        65: 160,
        66: 160,
        67: 160,
        68: 160,
        69: 160,
        70: 160,
        71: 160,
        72: 160,
        73: 160,
        74: 160,
        75: 160,
        76: 160,
        77: 160,
        78: 160,
        79: 160,
        80: 160,
        81: 160,
        82: 160,
        83: 160,
        84: 160,
        85: 160,
        86: 160,
        87: 160,
        88: 160,
        89: 160,
        90: 160,
        91: 160,
        92: 160,
        93: 160,
        94: 160,
        95: 160,
        96: 160,
        97: 160,
        98: 160,
        99: 160,
        100: 160,
        101: 160,
        102: 160,
        103: 160,
        104: 160,
        105: 160,
        106: 160,
        107: 160,
        108: 160,
        109: 160,
        110: 160,
        111: 160,
        112: 160,
        113: 160,
        114: 160,
        115: 160,
        116: 160,
        117: 160,
        118: 160,
        119: 160,
        120: 144,
        121: 144,
        122: 144,
        123: 144,
        124: 144,
        125: 144,
        126: 144,
        127: 144,
        128: 144,
        129: 144,
        130: 144,
        131: 144,
        132: 144,
        133: 144,
        134: 144,
        135: 144,
        136: 144,
        137: 144,
        138: 144,
        139: 144,
        140: 144,
        141: 144,
        142: 144,
        143: 144,
        144: 144,
        145: 144,
        146: 144,
        147: 144,
        148: 144,
        149: 144,
        150: 144,
        151: 144,
        152: 144,
        153: 144,
        154: 144,
        155: 144,
        156: 144,
        157: 144,
        158: 144,
        159: 144,
        160: 144,
        161: 144,
        162: 144,
        163: 144,
        164: 144,
        165: 144,
        166: 144,
        167: 144,
        168: 144,
        169: 144,
        170: 144,
        171: 144,
        172: 144,
        173: 144,
        174: 144,
        175: 144,
        176: 144,
        177: 144,
        178: 144,
        179: 144,
        180: 144,
        181: 144,
        182: 144,
        183: 144,
        184: 144,
        185: 144,
        186: 144,
        187: 144,
        188: 144,
        189: 144,
        190: 144,
        191: 144,
        192: 144,
        193: 144,
        194: 144,
        195: 144,
        196: 144,
        197: 144,
        198: 144,
        199: 144,
        200: 144,
        201: 144,
        202: 144,
        203: 144,
        204: 144,
        205: 144,
        206: 144,
        207: 128,
        208: 128,
        209: 128,
        210: 128,
        211: 128,
        212: 128,
        213: 128,
        214: 128,
        215: 128,
        216: 128,
        217: 128,
        218: 128,
        219: 128,
        220: 128,
        221: 128,
        222: 128,
        223: 128,
        224: 128,
        225: 128,
        226: 128,
        227: 128,
        228: 128,
        229: 128,
        230: 128,
        231: 128,
        232: 128,
        233: 128,
        234: 128,
        235: 128,
        236: 128,
        237: 128,
        238: 128,
        239: 128,
        240: 128,
        241: 128,
        242: 128,
        243: 128,
        244: 128,
        245: 128,
        246: 128,
        247: 128,
        248: 128,
        249: 128,
        250: 128,
        251: 128,
        252: 112,
        253: 112,
        254: 112,
        255: 112,
        256: 112,
        257: 112,
        258: 112,
        259: 112,
        260: 112,
        261: 112,
        262: 112,
        263: 112,
        264: 112,
        265: 112,
        266: 112,
        267: 112,
        268: 112,
        269: 112,
        270: 112,
        271: 112,
        272: 112,
        273: 112,
        274: 112,
        275: 112,
        276: 112,
        277: 112,
        278: 112,
        279: 112,
        280: 112,
        281: 112,
        282: 112,
        283: 96,
        284: 96,
        285: 96,
        286: 96,
        287: 96,
        288: 96,
        289: 96,
        290: 96,
        291: 96,
        292: 96,
        293: 96,
        294: 96,
        295: 96,
        296: 96,
        297: 96,
        298: 96,
        299: 96,
        300: 96,
        301: 96,
        302: 96,
        303: 96,
        304: 96,
        305: 96,
        306: 96,
        307: 80,
        308: 80,
        309: 80,
        310: 80,
        311: 80,
        312: 80,
        313: 80,
        314: 80,
        315: 80,
        316: 80,
        317: 80,
        318: 80,
        319: 80,
        320: 80,
        321: 80,
        322: 80,
        323: 80,
        324: 80,
        325: 80,
        326: 80,
        327: 64,
        328: 64,
        329: 64,
        330: 64,
        331: 64,
        332: 64,
        333: 64,
        334: 64,
        335: 64,
        336: 64,
        337: 64,
        338: 64,
        339: 64,
        340: 64,
        341: 64,
        342: 64,
        343: 64,
        344: 64,
        345: 64,
        346: 48,
        347: 48,
        348: 48,
        349: 48,
        350: 48,
    }

    @property
    def adc_bit_depth(self) -> int:
        return 12

    @property
    def offset(self) -> int:
        return 10

    @property
    def exposure_min(self) -> int:
        # 1 microseconds
        return 1

    @property
    def exposure_max(self) -> int:
        # 5 min
        return 300_000_000

    @property
    def gain_day(self):
        return 0

    @property
    def gain_night(self):
        return 200

    def get_bias_median(self, exposure_us: int, gain: int) -> int:
        return ASI224MC.BIAS_MEDIAN_LOOKUP[gain]

    def get_e_per_adu(self, gain: int) -> float:
        return 4.68 * math.exp(-0.0114 * gain)
